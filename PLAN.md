# üìã –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Advanced API

## üéØ –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å production-ready API —Å:
- JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏
- CI/CD pipeline
- Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π

---

## üìÖ –≠—Ç–∞–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (5-7 –¥–Ω–µ–π)

### ‚úÖ –≠—Ç–∞–ø 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ (2-3 —á–∞—Å–∞)

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

**–ó–∞–¥–∞—á–∏:**
1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å `go.mod` —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏:
   - `github.com/gin-gonic/gin` - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
   - `gorm.io/gorm` - ORM
   - `gorm.io/driver/postgres` - PostgreSQL –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è GORM
   - `github.com/golang-jwt/jwt/v5` - JWT
   - `golang.org/x/crypto/bcrypt` - —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
   - `github.com/go-playground/validator/v10` - –≤–∞–ª–∏–¥–∞—Ü–∏—è
   - `go.uber.org/zap` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - `github.com/spf13/viper` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
3. –°–æ–∑–¥–∞—Ç—å `docker-compose.yml`
4. –°–æ–∑–¥–∞—Ç—å `Makefile` –¥–ª—è –∫–æ–º–∞–Ω–¥

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–±–æ—á–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

### ‚úÖ –≠—Ç–∞–ø 2: GORM –º–æ–¥–µ–ª–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ (2-3 —á–∞—Å–∞)

**–¶–µ–ª—å:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å –ë–î —á–µ—Ä–µ–∑ GORM

**–ó–∞–¥–∞—á–∏:**
1. –°–æ–∑–¥–∞—Ç—å GORM –º–æ–¥–µ–ª–∏:
   ```go
   type User struct {
       ID        uint      `gorm:"primaryKey"`
       Email     string    `gorm:"uniqueIndex;not null"`
       Name      string    `gorm:"not null"`
       Password  string    `gorm:"not null"`
       Role      string    `gorm:"default:'user'"`
       CreatedAt time.Time
       UpdatedAt time.Time
   }
   ```

2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Auto Migration
3. –°–æ–∑–¥–∞—Ç—å Repository —Å GORM –º–µ—Ç–æ–¥–∞–º–∏:
   - `Create`, `FindByID`, `FindAll`, `Update`, `Delete`
   - `FindByEmail` (–¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–±–æ—Ç–∞ —Å –ë–î —á–µ—Ä–µ–∑ GORM

---

### ‚úÖ –≠—Ç–∞–ø 3: Gin —Ä–æ—É—Ç–µ—Ä –∏ –±–∞–∑–æ–≤—ã–µ endpoints (2-3 —á–∞—Å–∞)

**–¶–µ–ª—å:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Gin –∏ —Å–æ–∑–¥–∞—Ç—å CRUD endpoints

**–ó–∞–¥–∞—á–∏:**
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Gin —Ä–æ—É—Ç–µ—Ä
2. –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É routes `/api/v1`
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å User handlers:
   - GET `/users` - —Å–ø–∏—Å–æ–∫
   - GET `/users/:id` - –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
   - PUT `/users/:id` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
   - DELETE `/users/:id` - —É–¥–∞–ª–µ–Ω–∏–µ
4. –î–æ–±–∞–≤–∏—Ç—å –±–∞–∑–æ–≤—ã–µ middleware:
   - CORS
   - Logger
   - Recovery

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–±–æ—á–∏–π REST API –Ω–∞ Gin

---

### ‚úÖ –≠—Ç–∞–ø 4: JWT –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (3-4 —á–∞—Å–∞)

**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –≤—Ö–æ–¥ –∏ –∑–∞—â–∏—Ç—É endpoints

**–ó–∞–¥–∞—á–∏:**
1. –°–æ–∑–¥–∞—Ç—å JWT —É—Ç–∏–ª–∏—Ç—ã:
   - `GenerateToken(userID, email)` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
   - `ValidateToken(tokenString)` - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
   - `ExtractClaims(token)` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Auth Service:
   - `Register(email, name, password)` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä–æ–ª—è
   - `Login(email, password)` - –≤—Ö–æ–¥ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–∞—Ä–æ–ª—è
   - `GetCurrentUser(userID)` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

3. –°–æ–∑–¥–∞—Ç—å Auth Handlers:
   - POST `/auth/register`
   - POST `/auth/login`
   - GET `/auth/me` (—Ç—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω)

4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Auth Middleware:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–æ–∫–µ–Ω–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ userID –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–∞—è JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

---

### ‚úÖ –≠—Ç–∞–ø 5: Middleware –∏ —É–ª—É—á—à–µ–Ω–∏—è (2-3 —á–∞—Å–∞)

**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å production-ready middleware

**–ó–∞–¥–∞—á–∏:**
1. **Logging Middleware:**
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
   - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
   - –°—Ç–∞—Ç—É—Å –∫–æ–¥
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ zap logger

2. **CORS Middleware:**
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö origins
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ preflight –∑–∞–ø—Ä–æ—Å–æ–≤

3. **Rate Limiting:**
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 100/–º–∏–Ω)
   - –ó–∞—â–∏—Ç–∞ –æ—Ç DDoS

4. **Request ID:**
   - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
   - –î–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞

5. **Validator:**
   - –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - –ö—Ä–∞—Å–∏–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Production-ready middleware

---

### ‚úÖ –≠—Ç–∞–ø 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (4-5 —á–∞—Å–æ–≤)

**–¶–µ–ª—å:** –ü–æ–∫—Ä—ã—Ç—å –∫–æ–¥ —Ç–µ—Å—Ç–∞–º–∏

**–ó–∞–¥–∞—á–∏:**
1. **Unit —Ç–µ—Å—Ç—ã –¥–ª—è Service:**
   ```go
   func TestUserService_CreateUser(t *testing.T) {
       // Arrange
       mockRepo := &MockUserRepository{}
       service := NewUserService(mockRepo)
       
       // Act
       user, err := service.CreateUser(...)
       
       // Assert
       assert.NoError(t, err)
       assert.NotNil(t, user)
   }
   ```

2. **Unit —Ç–µ—Å—Ç—ã –¥–ª—è Handlers:**
   - –ò—Å–ø–æ–ª—å–∑—É—è `httptest`
   - –ú–æ–∫–∏ –¥–ª—è service

3. **Integration —Ç–µ—Å—Ç—ã:**
   - –¢–µ—Å—Ç–æ–≤–∞—è –ë–î
   - –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª (—Å–æ–∑–¥–∞–Ω–∏–µ ‚Üí —á—Ç–µ–Ω–∏–µ ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ‚Üí —É–¥–∞–ª–µ–Ω–∏–µ)

4. **JWT —Ç–µ—Å—Ç—ã:**
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
   - –í–∞–ª–∏–¥–∞—Ü–∏—è
   - –ò—Å—Ç—ë–∫—à–∏–π —Ç–æ–∫–µ–Ω

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** > 80% code coverage

---

### ‚úÖ –≠—Ç–∞–ø 7: Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (1-2 —á–∞—Å–∞)

**–¶–µ–ª—å:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

**–ó–∞–¥–∞—á–∏:**
1. –î–æ–±–∞–≤–∏—Ç—å swagger –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏:
   ```go
   // @Summary Create user
   // @Tags users
   // @Accept json
   // @Produce json
   // @Param user body CreateUserRequest true "User data"
   // @Success 201 {object} User
   // @Router /users [post]
   func (h *UserHandler) CreateUser(c *gin.Context) {
       // ...
   }
   ```

2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: `swag init`
3. Swagger UI –Ω–∞ `/swagger/*`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

---

### ‚úÖ –≠—Ç–∞–ø 8: Docker –∏ –¥–µ–ø–ª–æ–π (2-3 —á–∞—Å–∞)

**–¶–µ–ª—å:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

**–ó–∞–¥–∞—á–∏:**
1. **Dockerfile (multi-stage build):**
   - Builder stage (–∫–æ–º–ø–∏–ª—è—Ü–∏—è)
   - Runtime stage (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑)

2. **docker-compose.yml:**
   - API —Å–µ—Ä–≤–∏—Å
   - PostgreSQL
   - Redis (–¥–ª—è –∫–µ—à–∞)
   - pgAdmin (–¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î)

3. **GitHub Actions CI/CD:**
   - –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
   - –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞
   - –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

4. **–î–µ–ø–ª–æ–π –Ω–∞ VPS:**
   - Docker Compose –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   - Nginx reverse proxy
   - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –≤ production

---

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### Makefile –∫–æ–º–∞–Ω–¥—ã:

```bash
make run          # –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
make test         # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
make test-coverage # –¢–µ—Å—Ç—ã —Å coverage
make docker-build # –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑
make docker-up    # –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Docker Compose
make docker-down  # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
make migrate-up   # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make migrate-down # –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make swagger      # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
make lint         # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
make fmt          # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ (–ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è)

- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~2000-2500
- **–§–∞–π–ª–æ–≤:** ~25-30
- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:** >80%
- **Endpoints:** ~10-12
- **Middleware:** ~5-6
- **Docker services:** 3-4

---

## üéØ –ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å?

**–ü–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç—ã:**
1. –Ø —Å–æ–∑–¥–∞–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Ñ–∞–π–ª—ã
2. –í—ã –±—É–¥–µ—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –ø–æ —à–∞–≥–∞–º
3. –Ø –ø—Ä–æ–≤–µ—Ä—è—é –∏ –æ–±—ä—è—Å–Ω—è—é
4. –î–≤–∏–≥–∞–µ–º—Å—è –¥–∞–ª—å—à–µ

**–ù–∞—á–∏–Ω–∞–µ–º —Å –≠—Ç–∞–ø–∞ 1?** üöÄ

